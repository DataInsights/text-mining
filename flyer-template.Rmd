---
title: "Pubmed Literature Tracking in R"
subtitle: "Searching and visually comparing different fields"
author: "Teresia Mrema-Buza"
date: "<strong>Last Updated</strong>: `r Sys.Date()`"
site: bookdown::bookdown_site
knit: bookdown::render_book
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    # vertical_layout: fill
    # vertical_layout: fill
    vertical_layout: scroll
  # html_document:
  # pdf_document:
  # word_document:
  bookdown::bs4_book:
    template: bs4_text_mining_template.html
    toc_depth: 6
    favicon: "favicon.ico"
    footnotes_inline: false
    split_bib: false
    repo:
      base: https://github.com/DataInsights/text-mining/
      branch: main
      # subdir: book
      icon: "fas fa-air-freshener"
    theme:
      fg: "black"
      bg: "#FFFEFA"
      primary: "#277DB0"
      secondary: "#277DB0"
      success: "#277DB0"
      info: "#277DB0"
      warning: "#277DB0"
      danger: "#277DB0"
      base_font:
        google: Sen
      heading_font:
        google:
          family: Bitter
          wght: 300
      code_font:
        google:
          # arguments to sass::font_google()
          family: DM Mono
          local: false
css:
- style.css
bibliography:
- library/articles.bib
- library/software.bib
citation_package:
- natbib
- biblatex
- amsplain
---

```{r setup, include=FALSE}
source("R/common.R")
library(flexdashboard)
library(tidyverse, suppressPackageStartupMessages())
```


# Getting PubMed Entrez Data
```{r fig.cap="Microbiome Workflow", include=FALSE}
library(DiagrammeR)
library(DiagrammeRsvg)

mermaidgraph <- mermaid("graph TD
A[NCBI PubMed Database] --> |Search Term| B[Microbiome]
B --> |Search Results| C[Indexed Papers in PubMed]
C --> |Download results| D[Results by Year in CSV format]
D --> |Filename| E[PubMed_Timeline_Results_by_Year.csv]
E --> F[Save file in data directory]
F -.-> G[Further Analysis in R]

", height = 800, width = 1000)

mermaidgraph

```


<a href=""><img src="img/pubmed_lit_search.png" alt="Book cover" width="40%" style="padding: 0px 0px 50px 0px; float: right;"/></a>

## Quick Glimpse {-}
Investigating the role of microbial communities in health and disease requires a thorough knowledge of the entire analytical process. Using wrong approaches can cost a significant amount of dollars and lengthy process to achieve the desired results. This is <b>PART 4</b> of the practical user guides intended to provide analytical support to the microbiome research community. The entire guide is reproducible, allowing users to easily follow along. If interested, user may use this model to publish their findings in a book format.

## Structure of this guide {-}
This guide is divided into chapters to facilitate easy navigation. Each chapter contains several sections as displayed in the navigation bars on the left and right. Click the hyper-linked text if you want to jump into a specific chapter or section.

## Code availability {-}
The code that generated this guide is available at a public [GitHub repository](https://github.com/DataInsights/pubmed-tracking/) or via a [GH-Page](https://tmbuza.github.io/pubmed-tracking/). If interested you can request a consulting service by contacting the developer of this repo using <a href="https://complexdatainsights.com/contact-us">this contact form</a>. 



<!--chapter:end:index.Rmd-->

## Publications by year
```{r}
library(tidyverse)
library(rentrez)
library(glue)

read_csv("data/PubMed_Timeline_Results_by_Year.csv",
         skip=1) %>%
  ggplot(aes(x=Year, y=Count)) +
  geom_line() +
  theme_classic()
```

## Databases available in Entrez
```{r}
entrez_dbs()
```


## PubMed summary
```{r}
entrez_db_summary(db = "pubmed")
```


## PubMed search fields
```{r}
entrez_db_searchable(db = "pubmed")
```


## Hits on search term
```{r}
s <- entrez_search(db = "pubmed", term = "microbiome")
glimpse(s)
s$count
```

## Count by serach term(s)
```{r}
entrez_search(db = "pubmed", term = "Buza T [AUTH]")
entrez_search(db = "pubmed", term = "mothur [ALL] AND microbiome")
entrez_search(db = "pubmed", term = "qiime [ALL] AND microbiome")
entrez_search(db = "pubmed", term = "dada2 [ALL] AND microbiome")
```

## Getting PMIDs
```{r}
microbiome <- entrez_search(db = "pubmed", term = "microbiome")$ids
head(microbiome)
```

## Pull out abstracts
```{r}
entrez_fetch(db="pubmed", id=head(microbiome, 1), rettype="abstract")
```

## Searching within a year
```{r}
entrez_search(db = "pubmed", term = "microbiome AND 2021[PDAT]")$count
```

## Searching within a range of years
```{r}
year <- 2015:2022
ubiome_search <- glue("microbiome AND {year}[PDAT]")
cancer_search <- glue("cancer AND {year}[PDAT]")
all_search <- glue("{year}[PDAT]")

search_counts <- tibble(year = year,
       ubiome_search = ubiome_search,
       cancer_search = cancer_search,
       all_search = all_search) %>%
  mutate(ubiome = map_dbl(ubiome_search, ~entrez_search(db="pubmed", term=.x)$count),
         cancer = map_dbl(cancer_search, ~entrez_search(db="pubmed", term=.x)$count),
         all = map_dbl(all_search, ~entrez_search(db="pubmed", term=.x)$count)
         )
```

## Compare publications
```{r}
search_counts %>%
  select(year, ubiome, cancer, all) %>%
  filter(year != 2022) %>%
  pivot_longer(-year) %>%
  ggplot(aes(x=year, y= value, group=name, color=name)) +
  geom_line() + 
  theme_classic()

```

## Compare publications
```{r}
search_counts %>%
  select(year, ubiome, cancer, all) %>%
  filter(year != 2022) %>%
  mutate(rel_ubiome = 100 * ubiome / all) %>%
  ggplot(aes(x=year,  y=rel_ubiome)) +
  geom_line() +
  scale_y_log10() + 
  theme_classic()
  
```

## Compare relative publications byfields {#relpubs-by-field}
```{r}
# thumbnail
search_counts %>%
  select(year, ubiome, cancer, all) %>%
  filter(year != 2022) %>%
  mutate(rel_ubiome = 100 * ubiome / all,
         rel_cancer = 100 * cancer / all) %>%
  select(year, starts_with("rel")) %>%
  pivot_longer(-year) %>%
  ggplot(aes(x=year, y=value, group=name, color=name)) +
  geom_line(size=1) +
  scale_y_log10(limits=c(NA, 100),
                breaks=c(0.01, 0.1, 1, 10, 100),
                labels=c("0.01", "0.1", "1", "10", "100")) +
  labs(x="Year", y="Percentage of all papers in PubMed") +
  scale_color_manual(name=NULL,
                     label=c("Cancer", "Microbiome"),
                     values=c("gray", "red"),
                     breaks=c("rel_cancer", "rel_ubiome")) +
  theme_classic() 

ggsave("figures/microbiome_vs_cancer.png", width=6, height=4)
```


<!--chapter:end:03_pubmed_literature.Rmd-->

